YUI.add("moodle-atto_aic-button",function(i,t){var n="atto_aic",s={TEXTINPUT:"atto_aic_textentry",INPUTSUBMIT:"atto_aic_promptentrysubmit",RESPONSE:"atto_aic_response"};i.namespace("M.atto_aic").Button=i.Base.create("button",i.M.editor_atto.EditorPlugin,[],{initializer:function(){this.get("allowed")&&this.addButton({callback:this._toggleMai,icon:"icon",iconComponent:"atto_aic",tags:"aic",buttonName:"MAI"})},_toggleMai:function(){var t=this.getDialogue({headerContent:M.util.get_string("header",n),width:"800px",focusAfterHide:!0});t.set("bodyContent",this._getDialogueContent()),t.show()},_getDialogueContent:function(){var t=i.Handlebars.compile('<form class="atto_form"><div class="row"><div class="mb-1 col-md-12"><div class="alert alert-info">{{get_string "help" component}}</div></div><div class="mb-1 col-md-8"><textarea class="form-control fullwidth text {{CSSSEL.TEXTINPUT}}" type="text" id="{{elementid}}_atto_aic_prompttext"  placeholder="{{get_string "placeholder" component}}"></textarea></div><div class="mdl-align col-md-4"><button type="button" class="btn btn-secondary  {{CSSSEL.INPUTSUBMIT}}">{{get_string "buttonname" component}}</button></div></div><br/><div class=" row {{CSSSEL.RESPONSE}}"></div></form>');return this._form=this._content=i.Node.create(t({component:n,CSSSEL:s})),this._currentSelection=this.get("host").getSelection(),(t=(t=(t=this._currentSelection[0].text()).substr(0,t.length).slice(-1e3)).trim())&&this._form.one("."+s.TEXTINPUT).set("value",t),this._form.one("."+s.INPUTSUBMIT).on("click",this._generateText,this),this._content},_generateText:function(){var t,e,o=this._form.one("."+s.TEXTINPUT).get("value");o.length<3?this._form.one("."+s.RESPONSE).setHTML("<div class='alert alert-danger'>"+M.util.get_string("textlength",n)+"</div>"):(o=o.substr(0,o.length).slice(-1e3),this._form.one("."+s.RESPONSE).setHTML("<i class='fa fa-spinner' aria-hidden='true'></i>"),t="#"+this._form.get("id"),e=M.cfg.wwwroot+"/lib/editor/atto/plugins/aic/ajax.php",o={sesskey:M.cfg.sesskey,action:"get",text:o},i.io(e,{context:this,data:o,timeout:5e4,on:{complete:this._loadContent,start:function(){i.one(t+" .atto_aic_promptentrysubmit").set("disabled",!0),i.one(t+" ."+s.RESPONSE).setHTML('<div class="spinner-grow text-success .aicspinner" role="status"><span class="sr-only">Loading...</span></div><h4> Generating content ...</h4>')},failure:function(){i.one(t+" ."+s.RESPONSE).setHTML('<div class="alert alert-danger" role="alert"> '+M.util.get_string("error",n)+"</div>")},end:function(){i.one(t+" .atto_aic_promptentrysubmit").set("disabled",!0)}}}))},_loadContent:function(t,e){var o,n;200==e.status&&(n=(o=this)._form.get("id"),i.one((n="#"+n)+" ."+s.RESPONSE).setHTML(e.response),o.get("host").setSelection(this._currentSelection),i.one(n+" #inserttext1").on("click",function(){o.get("host").insertContentAtFocusPoint(i.one(n+" #text1 .response").getHTML()),o.markUpdated()}),i.one(n+" #inserttext1").on("click",function(){o.get("host").insertContentAtFocusPoint(i.one(n+" #text2 .response").getHTML()),o.markUpdated()}),i.one(n+" #inserttext1").on("click",function(){o.get("host").insertContentAtFocusPoint(i.one(n+" #text3 .response").getHTML()),o.markUpdated()}))}},{ATTRS:{allowed:!1}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});