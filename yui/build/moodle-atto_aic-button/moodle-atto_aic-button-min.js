YUI.add("moodle-atto_aic-button",function(t,e){var o="atto_aic",i={TEXTINPUT:"atto_aic_textentry",INPUTSUBMIT:"atto_aic_promptentrysubmit",RESPONSE:"atto_aic_response"};TEMPLATE='<form class="atto_form"><div class="row"><div class="mb-1 col-md-12"><div class="alert alert-info">{{get_string "help" component}}</div></div><div class="mb-1 col-md-8"><textarea class="form-control fullwidth text {{CSS.TEXTINPUT}}" type="text" id="{{elementid}}_atto_aic_prompttext"  placeholder="{{get_string "placeholder" component}}"></textarea></div><div class="mdl-align col-md-4"><button type="button" class="btn btn-secondary  {{CSS.INPUTSUBMIT}}">{{get_string "buttonname" component}}</button></div></div><br/><div class=" row {{CSS.RESPONSE}}"></div></form>',YUI.add("moodle-atto_aic-button",function(e,t){e.namespace("M.atto_aic").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){this.get("is_allowed")&&this.addButton({callback:this._toggleaic,icon:"icon",iconComponent:"atto_aic",tags:"aic",buttonName:"aic"})},_toggleaic:function(){var t=this.getDialogue({headerContent:M.util.get_string("header",o),width:"800px",focusAfterHide:!0});t.set("bodyContent",this._getDialogueContent()),t.show()},_getDialogueContent:function(){return template=e.Handlebars.compile(TEMPLATE),this._form=this._content=e.Node.create(template({component:o,CSS:i})),this._currentSelection=this.get("host").getSelection(),seltext=this._currentSelection[0].text(),seltext=seltext.substr(0,seltext.length).slice(-1e3),seltext=$.trim(seltext),seltext&&this._form.one("."+i.TEXTINPUT).set("value",seltext),this._form.one("."+i.INPUTSUBMIT).on("click",this._generateText,this),this._content},_generateText:function(){var t=this._form.one("."+i.TEXTINPUT).get("value");t.length<3?this._form.one("."+i.RESPONSE).setHTML("<div class='alert alert-danger'>"+M.util.get_string("textlength",o)+"</div>"):(t=t.substr(0,t.length).slice(-1e3),this._form.one("."+i.RESPONSE).setHTML("<i class='fa fa-spinner' aria-hidden='true'></i>"),$form_id=this._form.get("id"),$form_id=$("#"+$form_id),ajaxurl=M.cfg.wwwroot+"/lib/editor/atto/plugins/aic/ajax.php",params={sesskey:M.cfg.sesskey,action:"get",text:t},e.io(ajaxurl,{context:this,data:params,timeout:5e4,on:{complete:this._loadContent,start:function(){$(".atto_aic_promptentrysubmit",$form_id).prop("disabled",!0),$("."+i.RESPONSE,$form_id).html('<div class="spinner-grow text-success .aicspinner" role="status"><span class="sr-only">Loading...</span></div><h4> Generating content ...</h4>')},failure:function(){$("."+i.RESPONSE,$form_id).html('<div class="alert alert-danger" role="alert"> '+M.util.get_string("error",o)+"</div>")},end:function(){$(".aicspinner",$form_id).remove(),$(".atto_aic_promptentrysubmit",$form_id).prop("disabled",!1)}}}))},_loadContent:function(t,e){200==e.status&&(self=this,$form_id=this._form.get("id"),$form_id=$("#"+$form_id),$(".atto_aic_response",$form_id).html(e.response),self.get("host").setSelection(this._currentSelection),$("#inserttext1",$form_id).on("click",function(){self.get("host").insertContentAtFocusPoint($(".response","#text1").text()),self.markUpdated()}),$("#inserttext2",$form_id).on("click",function(){self.get("host").insertContentAtFocusPoint($(".response","#text2").text()),self.markUpdated()}),$("#inserttext3",$form_id).on("click",function(){self.get("host").insertContentAtFocusPoint($(".response","#text3").text()),self.markUpdated()}))}},{ATTRS:{is_allowed:!1}})},"@VERSION@",{requires:["moodle-editor_aic-plugin"]})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});