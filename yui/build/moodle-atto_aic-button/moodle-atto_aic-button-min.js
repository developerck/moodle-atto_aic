YUI.add("moodle-atto_aic-button",function(e,t){var o="atto_aic";TEMPLATE='<form class="atto_form"><div class="row"><div class="mb-1 col-md-12"><div class="alert alert-info">{{get_string "help" component}}</div></div><div class="mb-1 col-md-8"><textarea class="form-control fullwidth text {{CSSSEL.TEXTINPUT}}" type="text" id="{{elementid}}_atto_aic_prompttext"  placeholder="{{get_string "placeholder" component}}"></textarea></div><div class="mdl-align col-md-4"><button type="button" class="btn btn-secondary  {{CSSSEL.INPUTSUBMIT}}">{{get_string "buttonname" component}}</button></div></div><br/><div class=" row {{CSSSEL.RESPONSE}}"></div></form>',e.namespace("M.atto_aic").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){this.get("allowed")&&this.addButton({callback:this._toggleMai,icon:"icon",iconComponent:"atto_aic",tags:"aic",buttonName:"MAI"})},_toggleMai:function(){var t=this.getDialogue({headerContent:M.util.get_string("header",o),width:"800px",focusAfterHide:!0});t.set("bodyContent",this._getDialogueContent()),t.show()},_getDialogueContent:function(){return template=e.Handlebars.compile(TEMPLATE),this._form=this._content=e.Node.create(template({component:o,CSSSEL:CSSSEL})),this._currentSelection=this.get("host").getSelection(),seltext=this._currentSelection[0].text(),seltext=seltext.substr(0,seltext.length).slice(-1e3),seltext=$.trim(seltext),seltext&&this._form.one("."+CSSSEL.TEXTINPUT).set("value",seltext),this._form.one("."+CSSSEL.INPUTSUBMIT).on("click",this._generateText,this),this._content},_generateText:function(){var t=this._form.one("."+CSSSEL.TEXTINPUT).get("value");t.length<3?this._form.one("."+CSSSEL.RESPONSE).setHTML("<div class='alert alert-danger'>"+M.util.get_string("textlength",o)+"</div>"):(t=t.substr(0,t.length).slice(-1e3),this._form.one("."+CSSSEL.RESPONSE).setHTML("<i class='fa fa-spinner' aria-hidden='true'></i>"),$formid=this._form.get("id"),$formid=$("#"+$formid),ajaxurl=M.cfg.wwwroot+"/lib/editor/atto/plugins/aic/ajax.php",params={sesskey:M.cfg.sesskey,action:"get",text:t},e.io(ajaxurl,{context:this,data:params,timeout:5e4,on:{complete:this._loadContent,start:function(){$(".atto_aic_promptentrysubmit",$formid).prop("disabled",!0),$("."+CSSSEL.RESPONSE,$formid).html('<div class="spinner-grow text-success .aicspinner" role="status"><span class="sr-only">Loading...</span></div><h4> Generating content ...</h4>')},failure:function(){$("."+CSSSEL.RESPONSE,$formid).html('<div class="alert alert-danger" role="alert"> '+M.util.get_string("error",o)+"</div>")},end:function(){$(".aicspinner",$formid).remove(),$(".atto_aic_promptentrysubmit",$formid).prop("disabled",!1)}}}))},_loadContent:function(t,e){200==e.status&&(tself=this,$formid=this._form.get("id"),$formid=$("#"+$formid),$(".atto_aic_response",$formid).html(e.response),tself.get("host").setSelection(this._currentSelection),$("#inserttext1",$formid).on("click",function(){tself.get("host").insertContentAtFocusPoint($(".response","#text1").text()),tself.markUpdated()}),$("#inserttext2",$formid).on("click",function(){tself.get("host").insertContentAtFocusPoint($(".response","#text2").text()),tself.markUpdated()}),$("#inserttext3",$formid).on("click",function(){tself.get("host").insertContentAtFocusPoint($(".response","#text3").text()),tself.markUpdated()}))}},{ATTRS:{allowed:!1}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});